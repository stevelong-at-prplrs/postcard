(()=>{var B;typeof window<"u"&&(B=typeof Promise<"u"?new Promise(n=>window.addEventListener("load",n)):{then:n=>window.addEventListener("load",n)});var P=z(),A=new RegExp("^"+c(P));function D(n){return n===self.location.origin}function z(){return self.registration?new URL(registration.scope).pathname.replace(/\/$/,""):location.pathname.replace(/\/[^\/]+$/,"")}function M(n){return n.replace(A,"")}function c(n){if(typeof n=="string"){var e=/([\^\$\[\]\(\)\{\}\+\*\.\|\?])/g;return n.replace(e,"\\$1")}}var b=class{constructor(e,t){this._resolve=e,this._reject=t}html(e,t){this.send(e,{type:"text/html",...t})}text(e,t){this.send(e,t)}json(e,t){this.send(JSON.stringify(e),{type:"application/json",...t})}blob(e,t={}){this._resolve(new Response(e,t))}send(e,{type:t="text/plain",...r}={}){[void 0,null].includes(e)||(e=new Blob([e],{type:t})),this.blob(e,r)}async fetch(e){if(typeof e=="string"){let t=await fetch(e),r=t.headers.get("Content-Type")??"application/octet-stream";this.send(await t.arrayBuffer(),{type:r})}else if(e instanceof Request)return fetch(e).then(this._resolve).catch(this._reject)}download(e,{filename:t="download",type:r="text/plain",...s}={}){let o={"Content-Disposition":`attachment; filename="${t}"`};this.send(e,{type:r,headers:o,...s})}redirect(e,t){t===void 0&&(t=e,e=302),t.match(/https?:\/\//)||(t=P+t),this._resolve(Response.redirect(t,e))}sse({onClose:e}={}){let t,r,s,o;return s=new ReadableStream({cancel(){o=!0,S(e)},start:i=>{t=function(a){if(!o){let _=I(a),y=new TextEncoder().encode(_);i.enqueue(y)}},r=function(){i.close(),s=null,S(e)}}}),this._resolve(new Response(s,{headers:{"Content-Type":"text/event-stream; charset=utf-8","Transfer-Encoding":"chunked",Connection:"keep-alive"}})),{send:t,close:r}}};function N(){let n="[a-zA-Z_][a-zA-Z_0-9]*",e=this,t="{",r="}",s="*",o="\\d",i="?",a="(",_=")",y="+",R=".";e.route_parser=function(u,l){let m={},d=new RegExp("("+c(u)+n+c(l)+")","g"),g=new RegExp(["(",c(u),n,c(l),"|",c(s),"|",c(o),"|",c(R),"|",c(i),"|",c(a),"|",c(_),"|",c(y),")"].join(""),"g"),w=new RegExp(c(u)+"("+n+")"+c(l),"g");return function(h){let p=[],E=0,x=0;if(h=h.split(g).map(function(f,v,k){return f===a?x++:f===_&&x--,[a,y,_,i,R,o].includes(f)?f:f===s?(p.push(E++),"(.*?)"):f.match(d)?(p.push(f.replace(w,"$1")),"([^\\/]+)"):f}).join(""),x!==0)throw new Error(`BS: Unbalanced parentheses in an expression: ${h}`);return{re:h,names:p}}};let T=e.route_parser(t,r);e.parse=T,e.pick=function(u,l,m){let d,g;u instanceof Array?(d={},g=u,u.map(function(h){d[h]=h})):(g=Object.keys(u),d=u);let w=[];for(let h=g.length;h--;){let p=g[h],E;if(p.match(/:\/\//)){let v=new URL(p);if(v.origin!==m)continue;E=p.replace(v.origin,"")}else if(D(m))E=p;else continue;let x=T(E),f=l.match(new RegExp("^"+x.re+"$"));if(f){let v=f.slice(1),k={};v.length&&x.names.forEach((O,U)=>{k[O]=v[U]}),w.push({pattern:p,data:k})}}return w}}function q(n){return["<!DOCTYPE html>","<html>","<head>",'<meta charset="UTF-8">',"<title>BS</title>","</head>","<body>",...n,"</body>","</html>"].join(`
`)}function j(n){var e=q(["error","<p>error</p>",`<p>${n.message||n}</p>`,`<pre>${n.stack||""}</pre>`]);return[e,{status:500,statusText:"500 Server Error"}]}function I({data:n,event:e,retry:t,id:r}){return Object.entries({event:e,id:r,data:n,retry:t}).filter(([,s])=>s).map(([s,o])=>`${s}: ${o}`).join(`
`)+`

`}function S(n,...e){typeof n=="function"&&n(...e)}function L(n,e){if(n.length)return new Promise((t,r)=>{let s=0;(async function o(){let i=n[s];if(!i)return t();try{await e(i,function(){s++,o()})}catch(a){r(a)}})()})}var $=class{constructor({filter:e=()=>!0}={}){this._er_handlers=[],this._middlewares=[],this._routes={},this._timeout=5*60*1e3,this._parser=new N,self.addEventListener("fetch",t=>{if(e(t.request)===!1)return;let r=new Promise(async(s,o)=>{let i=t.request;try{let a=new b(s,o);await L(this._middlewares,function(l,m){return l(i,a,m)});let _=i.method,y=new URL(i.url),R=M(y.pathname),T=y.origin,u=this._routes[_];if(u){let l=this._parser.pick(u,R,T),m=l.length>1&&l.find(d=>!!d.pattern.match(/\*/));if(l.length){let d;m&&(d=l.find(w=>!w.pattern.match(/\*/))),m&&d||(d=l[0]);let g=[...this._middlewares,...u[d.pattern]];i.params=d.data,setTimeout(function(){o("Timeout Error")},this._timeout),await L(g,(w,h)=>w(i,a,h));return}}if(t.request.cache==="only-if-cached"&&t.request.mode!=="same-origin")return;fetch(t.request).then(s).catch(o)}catch(a){this._handle_error(s,i,a)}});t.respondWith(r.catch(()=>{}))}),["GET","POST","DELETE","PATCH","PUT"].forEach(t=>{this[t.toLowerCase()]=this.method(t)})}_handle_error(e,t,r){let s=new b(e);this._er_handlers.length?L(this._er_handlers,function(o,i){o(r,t,s,i)},function(o){s.html(...j(o))}):s.html(...j(r))}use(...e){e.forEach(t=>{typeof t=="function"&&(t.length===4?this._er_handlers.push(t):t.length===3&&this._middlewares.push(t))})}method(e){return function(t,r){this._routes[e]||(this._routes[e]={});let s=this._routes[e];return s[t]||(s[t]=[]),s[t].push(r),this}}};var G=(n,e,t,r)=>`${n} [${new Date().toISOString().split(".")[0]}] ${e} ${t} ${r}`,W=(n,e,t)=>G(n,e,t.url.replace("http://localhost:3001",""),t.headers.get(["user-agent"])),C=(n,e,t)=>n.forEach(r=>e[r]("/api/*",t(r))),F=["get","post","put","delete"];var Z=new $;C(F,Z,n=>async(e,t)=>{try{let r=await fetch(e.url,{method:n,headers:e.headers}).catch(()=>({status:500,statusText:"Internal Server Error",ok:!1}));return r&&r.status===200&&r.statusText==="OK"&&r.ok?t.text(await r.text()):t.text(W(200,n.toUpperCase(),e))}catch{}});})();
